<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Network Automation Files</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
      color: #212529;
      padding: 2rem;
      transition: background-color 0.3s, color 0.3s;
    }

    .dark-mode {
      background-color: #1e1e2f;
      color: #f8f9fa;
    }

    .section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 1.5rem;
      margin-bottom: 2rem;
      transition: background-color 0.3s, color 0.3s;
    }

    .dark-mode .section {
      background: #2b2b3c;
      box-shadow: 0 4px 12px rgba(255,255,255,0.05);
    }

    .file-entry {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e9ecef;
      padding: 0.5rem 0;
    }

    .dark-mode .file-entry {
      border-bottom: 1px solid #444;
    }

    .file-entry:last-child {
      border-bottom: none;
    }

    .file-entry a {
      text-decoration: none;
    }

    .file-entry span {
      word-break: break-word;
    }

    details summary {
      cursor: pointer;
      font-weight: 600;
      padding: 0.5rem 0;
    }

    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
    }
  </style>

</head>
<body>
<div class="container position-relative">
  <button class="btn btn-outline-secondary theme-toggle" onclick="toggleTheme()" id="themeButton">ğŸŒ™ Dark Mode</button>

  <h1 class="mb-4 text-primary text-center">ğŸ“ Network Automation Files</h1>

  <div class="mb-4">
    <input type="text" id="searchInput" class="form-control" placeholder="ğŸ” Search by device or timestamp..." onkeyup="filterFiles()">
  </div>

  <div class="section">
    <h3 class="text-info">ğŸ”· Outputs Folder</h3>
    <ul class="list-unstyled">
      {% for file in outputs %}
      <li class="file-entry">
        <span>ğŸ“„ {{ file }}</span>
        <a href="{{ url_for('serve_output_file', filename=file) }}" class="btn btn-sm btn-success">â¬‡ Download</a>
      </li>
      {% endfor %}
    </ul>
  </div>

  <div class="section">
    <h3 class="text-info">ğŸ“¦ Backups</h3>
    {% for timestamp, folders in backups.items() %}
    <details class="mb-3">
      <summary>ğŸ•’ Backup: {{ timestamp }}</summary>
      <ul class="list-unstyled ms-3">
        {% for folder, files in folders.items() %}
        <details class="mb-2">
          <summary>ğŸ“‚ {{ folder }}</summary>
          <ul class="list-unstyled ms-4">
            {% for file in files %}
            <li class="file-entry">
              <span>ğŸ“„ {{ file }}</span>
              <a href="/backups/{{ timestamp }}/{{ folder }}/{{ file }}" class="btn btn-sm btn-success">â¬‡ Download</a>
            </li>
            {% endfor %}
          </ul>
        </details>
        {% endfor %}
      </ul>
    </details>
    {% endfor %}
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function filterFiles() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const entries = document.querySelectorAll('.file-entry');
    entries.forEach(entry => {
      const text = entry.textContent.toLowerCase();
      entry.style.display = text.includes(input) ? '' : 'none';
    });
  }

  function toggleTheme() {
    const body = document.body;
    const button = document.getElementById('themeButton');
    body.classList.toggle('dark-mode');
    const isDark = body.classList.contains('dark-mode');
    button.textContent = isDark ? 'â˜€ï¸ Light Mode' : 'ğŸŒ™ Dark Mode';
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  }

  window.onload = () => {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.body.classList.add('dark-mode');
      document.getElementById('themeButton').textContent = 'â˜€ï¸ Light Mode';
    }
  };
</script>
</body>
</html>
